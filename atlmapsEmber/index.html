<html>
    <head>
        <!-- bower:js -->
        <script src="../bower_components/jquery/dist/jquery.js"></script>
        <script src="../bower_components/bootstrap/dist/js/bootstrap.js"></script>
        <script src="../bower_components/bootstrap-material-design/dist/js/material.js"></script>
        <script src="../bower_components/bootstrap-material-design/dist/js/ripples.js"></script>
        <script src="../bower_components/handlebars/handlebars.js"></script>
        <script src="../bower_components/ember/ember.js"></script>
        <script src="../bower_components/leaflet/dist/leaflet.js"></script>
        <script src="../bower_components/leaflet/dist/leaflet-src.js"></script>
        <script src="../bower_components/leaflet-ajax/dist/leaflet.ajax.js"></script>
        <script src="../bower_components/jquery.easing/js/jquery.easing.js"></script>
        <script src="../bower_components/ember-simple-auth/simple-auth.js"></script>
        <script src="../bower_components/ember-simple-auth/simple-auth-oauth2.js"></script>
        <script src="../bower_components/list.js/dist/list.js"></script>
        <!-- endbower -->
        <!--<script src="http://builds.emberjs.com/beta/ember-data.min.js"></script>-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ember-data.js/1.0.0-beta.12/ember-data.prod.js"></script>
        <script src="js/bootstrap-slider.js"></script>
        <script src="js/shuffle.js"></script>
        <script src="js/app.js"></script>
        
        <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,700,400italic,300' rel='stylesheet' type='text/css'>        <!-- bower:css -->
        <link rel='stylesheet' href='../bower_components/bootstrap/dist/css/bootstrap.css' />
        <link rel='stylesheet' href='../bower_components/bootstrap-material-design/dist/css/material.css' />
        <link rel='stylesheet' href='../bower_components/bootstrap-material-design/dist/css/ripples.css' />
        <link rel='stylesheet' href='../bower_components/leaflet/dist/leaflet.css' />
        <!-- endbower -->
        <link rel='stylesheet' href='css/bootstrap-slider.css' />
        <link rel='stylesheet' href='css/local.css' />
        <link rel='stylesheet' href='css/marker.css' />
    </head>
    <body>
        <script type="text/x-handlebars" data-template-name="application">
            <div class="navbar navbar-inverse navbar-clear">
              <div class="container-fluid">
                  <ul class="nav navbar-nav">
                      {{#link-to 'index' tagName='li' class='navbar-brand'}}ATLMaps{{/link-to}}
                      {{#link-to 'projects' tagName='li'}}<a>Projects</a>{{/link-to}}
                      {{#link-to 'about' tagName='li'}}<a>About</a>{{/link-to}}
                  </ul>
                  <ul class="nav navbar-nav navbar-right">
                    <li>
                      {{#if session.isAuthenticated}}
                          <a {{ action 'invalidateSession' }} class="btn btn-xs navbar-right nav-btn"><span class="glyphicon glyphicon-log-out"> Logout</span></a>
                      {{else}}
                          {{#link-to 'login' class="btn btn-xs navbar-right nav-btn"}}<span class="glyphicon glyphicon-log-in"> Login</span>{{/link-to}}
                      {{/if}}
                    </li>
                  </ul>
                  <span id="welcome" class="navbar-right">
                    Welcome: <em>{{#if session.user}}{{session.user.displayname}}{{else}}Guest{{/if}}</em></span>
              </div>
            </div>
            {{outlet "modal"}}
            <div class="content">
              {{outlet}}
              
            </div>
        </script>
        
        <script type="text/x-handlebars" data-template-name="index">
          <div id='banner'>
            <!--<h1>ATLMaps</h1>-->
          </div>
        </script>
        
        <script type='text/x-handlebars' data-template-name='projects/index'>
            <div class="continer" id="create_project">
                <a class="btn btn-add" {{action 'createProject'}}><span class="mdi-content-add mdi-large"></span>Create New Project</a></h3>
            </div>
            <div class="container" class="project-list">
                {{#if session.isAuthenticated}}
                    <h2>My Projects</h2>
                    {{#each project in myProjects}}
                        {{#if project.saved}}
                            <div>
                                <div class="well square">
                                    <h3 class="heading">{{#link-to 'project' project action='reload'}}{{project.name}}{{/link-to}}</h3>
                                    {{#if session.isAuthenticated}}
                                        <a class="btn btn-warning btn-fab action project-delete" {{action 'deleteProject' project.id}}>
                                            <span class="mdi-action-delete"></span>
                                        </a>
                                    {{/if}}
                                </div>
                            </div>
                        {{/if}}
                    {{/each}}
                {{/if}}
            </div>
            <div class="container" class="project-list">
                <h2>Projects</h2>
                {{#each project in this.model}}
                    {{#if project.published}}
                        <div>
                            <div class="well square">
                            {{mine}}
                                <h3 class="heading">{{#link-to 'project' project action='reload'}}{{project.name}}{{/link-to}}</h3>
                                <span>Created by: {{project.user.displayname}}</span>
                            </div>
                        </div>
                    {{/if}}
                {{/each}}
            </div>
        </script>
        
        <script type='text/x-handlebars' data-template-name='project'>
            <a class="btn btn-fab btn-sm pull-left" style="display:none;" id="show-layer-options"><span class="mdi-action-visibility"></span></a>
            <div class="layer-controls">
              <div class="card">
              {{mine}}
                {{#if mayEdit}}<a class="btn btn-material-lightblue btn-fab btn-xs btn-flat pull-right" id="config-layers" {{action 'showEditForm'}}><span class="mdi-action-settings"></span><div class="ripple-wrapper"></div></a>{{/if}}
                {{# if model.saved }}
                    <h1>{{model.name}}</h1>
                    <p>{{model.description}}</p>
                {{ else }}
                    {{#if session.isAuthenticated}}
                    <div class="row">
                        <div class='col-xs-7' id="title-input">
                            {{input valueBinding='projectName' placeholder='Enter Title for Project' class="form-control floating-label" type="text"}}
                        </div>
                        <div class='col-xs-3'>
                            <a class="btn btn-info btn-xs pull-right" id="title-button" {{action 'saveProject'}}><span>OK</span mdi-large></a>
                        </div>
                    </div>
                    {{/if}}
                {{/if}}
                {{!--{{#each layer in allLayers}}{{layer.name}}{{/each}}--}}
                <h3>Active Layers {{#if isMine}}{{partial 'addLayersButton'}}{{/if}}</h3>
                <hr/>
                <a class="btn btn-fab btn-sm btn-material-lightgrey top-layer-button" id="hide-layer-options"><span class="mdi-action-visibility-off"></span></a>
                
              </div>
              <div class="layer-list">
              
                <ul class="shuffle-items">
                  {{#each layer in showLayers}}
                  <li class="item">
                    <p class="alt text-muted">
                      <span class="layer_marker">{{ layer-marker projectID=model.id layerID=layer.id layerType=layer.name }}</span>
                      {{layer.name}}
                    </p>
                    <div class="list-group row">
                      <div class="list-group-item">
                        <div class="row-action-primary">
                          {{ layer-marker projectID=model.id layerID=layer.id }}
                        </div>
                        <div class="row-content">
                          <h4 class="list-group-item-heading">{{layer.name}}</h4>
                          <p class="list-group-item-text">{{layer.description}}</p>
                          <div class="text-muted">{{partial 'citation'}}</div>
                        </div>
                        <div class="col-xs-1 pull-right">
                          {{#if isMine}}<a class="btn rotate btn-added btn-fab btn-sm"{{action 'removeLayer' layer model.id}}><span class="mdi-content-clear"></span></a>{{/if}}
                          {{ opacity-slider layer=layer.layer layerID=layer.id }}
                        </div>
                      </div>
                    </div>
                    {{map-layers layerID=layer.id layerName=layer.layer projectID=model.id}}
                  </li>
                  {{else}}
                  <li class="item">
                    <h4 class="media-heading">No Layers yet</h4>
                    <p class="alt text-muted">No Layers yet</p>
                  </li>
                  {{/each}}
                </ul>
              </div>
              
              </div>
            <div class="row" id="base-map">
            {{ base-map }}
            </div>
            
            
            <div class="card" id='project_edit_form' style="display:none;left:-100%;">
              <h3>Project Options</h3>
              <div class="form-group">
              <label for="edit_name">Title for the Project</label>
                {{input valueBinding="name" name='name' id="edit_name" class="form-control h1"  }}
              </div>
              <div class="form-group">
                <label for="edit_description" class="form-control">Description (Max 255 Characters)</label>
                {{textarea valueBinding="description" id="edit_description" class="form-control" rows="4" placeholder="Enter your project description here..."}}
                
                <div class="publish_check">
                  <label>Publish</label>
                  {{input type="checkbox" valueBinding="published" checked=published}}
                </div>
                
                <div class="text-right">
                  <a class="btn btn-add" {{action 'updateProject'}}>Save</a>
                  <a class="btn btn-danger" {{action 'cancelUpdate'}}>Cancel</a>
                </div>
              </div>
              {{ collaborate-users }}
            </div>
            
        </script>

        <script type="text/x-handlebars" data-template-name="add-layer-modal">
          {{#layer-modal title='Add Layers' close='removeModal'}}
          <div class="list">
            {{#each layer in this}}
              {{#if layer.active}}
                <div {{bind-attr class=":layer-list-item :row :name layer.tag_slugs layer.institution.slug layer.layer_type" }}>
                  <div class="col-xs-2">
                    {{add-remove-layer-button title='Add' action='addLayer' param=layer model=model}}
                  </div>
                  <div class="col-xs-9">
                    {{ list-avaliable-layers layer=layer}}
                  </div>
                </div>
              {{/if}}
            {{/each}}
          </div>
          {{/layer-modal}}
        </script>
        
        <script type='text/x-handlebars' data-template-name='about'>
          <div id="banner">
            <div class="static_content">
            <p>ATLMaps is a collaboration between Georgia State University and Emory University. The project is in active and heavy development.</p>
            <p>The ATLmaps project combines archival maps, geospatial data visualization, and user contributed multimedia location pinpoints to promote investigation into any number of issues about Atlanta.  This innovative online platform will allow users to layer an increasing number of interdisciplinary data to address the complex issues that cities pose.  The project looks to offer a framework that incorporates storytelling reliant on the geospatial data and for normalizing input across a range of data sets about Atlanta so that material can be cross-compared in novel ways, allowing users to make connections between data sources and ask questions that would not be apparent when only looking at one particular project.  The ATLmaps project will also encourage knowledgeable members of the university and local communities to curate data on the site to demonstrate the possibilities for synthesizing material across projects and data types.</p>
            </div>
          </div>          
        </script>
        
        <script type='text/x-handlebars' data-template-name='login'>
            <header class="text-center alt-header">
                <h2>Start collaboraing and explore new layers.</h2>
                <p class="lead">Log in to continue.</p>
            </header>
            <div class="well login-form">
                <form {{action 'authenticate' on='submit'}} class="form" autocomplete="on">
                    <label for="identification" class="sr-only">Login</label>
                    <div class="form-group">
                        {{input value=identification placeholder='Email' class="form-control floating-label" type="text"}}
                    </div>
                    <label for="password" class="sr-only">Password</label>              
                    <div class="form-group">
                        {{input value=password placeholder='Password' type='password' class="form-control floating-label" autocomplete="off"}}
                    </div>
                    <button type="submit" class="btn btn-material-orange btn-block">Login</button>
                </form>
            </div>
        </script>
        
        <!-- COMPONENTS -->
        
        <script type="text/x-handlebars" data-template-name="components/base-map">
          <div id='map'></div>
        </script>
        
        <script type="text/x-handlebars" data-template-name="components/opacity-slider">
          <input style="display:none;" {{bind-attr class=":slider layer" name=layer}} {{action "opacityChange" on="change" param=layer}} value="10" data-slider-orientation="vertical" type="text"/>
          {{opacityslider}}
        </script>
        
        <script type="text/x-handlebars" data-template-name="components/layer-marker">
        
          <div {{bind-attr class='markerClass'}}>
            <div class="icon"></div>
          </div>
        </script> 
        
        <script type="text/x-handlebars" data-template-name="components/add-remove-layer-button">
          {{is_active}}
          {{#if layerAdded }}
            <a class="btn rotate btn-added btn-fab btn-sm" {{action 'buttonRemoveLayer' this.layer this.model.id }}><span class="mdi-action-done"></span></a>
          {{else}}
            <a class="btn rotate btn-add btn-fab btn-sm" {{action 'buttonAddLayer' this.layer}}><span class="mdi-content-add"></span></a>
          {{/if}}
        </script>
        
        <script type="text/x-handlebars" data-template-name="components/remove-layer-button">
            <a class="btn rotate btn-added btn-fab btn-sm"{{action 'removeLayer'}}><span class="mdi-content-clear"></span></a>
        </script>
        
        <script type="text/x-handlebars" data-template-name="components/list-avaliable-layers">
            <span {{bind-attr class="layer.layer_type" }}</span>
            <h4 class="name">{{layer.name}}</h4>
            <p>
              <div class="description">{{layer.description}}</div>
            </p>
            <p>
              {{partial 'tags'}}
            </p>
            <p>
              {{partial 'citation'}}
            </p>
        </script>

        <script type="text/x-handlebars" data-template-name="components/layer-modal">
          <div class="modal fade">
            <div class="modal-dialog">
              <div class="modal-content" id="searchableLayers">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="modal-header">
                  <div {{bind-attr class=":filter-heading showFilters:active"}}>
                    <a {{action 'toggleFilters'}} {{bind-attr class=":btn :rotate :btn-inverse :btn-fab :btn-sm showFilters:active"}}><span class="mdi-content-filter-list"> </span></a>
                    <h2>Available Layers</h2>
                  </div>
                  {{search-tags}}
                  
                </div>
                <hr />
                <div class="modal-body">
                  {{yield}}
                </div>
                <div class="modal-footer">
                  <a class="btn btn-default" data-dismiss="modal">Close</a>
                </div>
              </div>
            </div>
          </div>
        </script>
        
        <script type="text/x-handlebars" data-template-name="components/search-tags">
          <nav class="navbar navbar-inverse" id="filter_and_search">
            <ul class="nav navbar-nav">
            
              <li class="clear"><a {{action 'sortTags' 'all'}}>All</a></li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Tags <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  {{#each tag in tags}}
                    <li><a {{ action 'sortTags' tag.slug }}>{{tag.name}}</a></li>
                  {{/each}}
                </ul>
              </li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Type <span class="caret"></span></a>
                <ul class="dropdown-menu tags-dropdown" role="menu">
                  <li><a {{ action 'sortTags' 'geojson'}}>GeoJSON</a></li>
                  <li><a {{ action 'sortTags' 'planningatlanta'}}>GSU Tiles</a></li>
                  <li><a {{ action 'sortTags' 'wms'}}>WMS</a></li>
                  <li><a {{ action 'sortTags' 'wfs'}}>WFS</a></li>
                </ul>
              </li>
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Provider <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  {{#each institution in institutions}}
                    <li><a {{ action 'sortTags' institution.slug }}>{{institution.name}}</a></li>
                  {{/each}}
                </ul>
              </li>
              
              <li>
                <form class="navbar-form navbar-left" role="search">
                    {{input type="text" class="search form-control" placeholder="Search" value=searchTerm}}
                </form>
              </li>
              
            </ul>          
          </nav>
        </script>

        <script type="text/x-handlebars" data-template-name="components/map-layers">
          {{mappedLayers}}
        </script>
        
        <script type="text/x-handlebars" data-template-name="components/collaborate-users">
          <!--<hr/>
          Collaboraters:-->
          <ul>
            {{#each user in users}}<li>{{user.displayname}}</li>{{/each}}
          </ul>
        </script>
        
        <script type="text/x-handlebars" data-template-name='_tags'>
          {{#if layer.tag_ids}}
            <span class="glyphicon glyphicon-tags tagsIcon"></span><ul class="list-inline">{{#each tag in layer.tag_ids}}<li>{{tag.name}}</li>{{/each}}</ul>
          {{/if}}
        </script>
        
        <script type="text/x-handlebars" data-template-name='_citation'>
            <p>Provided by: <img {{bind-attr src='layer.institution.icon'}} alt='Logo' class="institution_logo" /> <span class="institution">{{layer.institution.name}}</span></p>
        </script>
        
        <script type="text/x-handlebars" data-template-name="_addLayersButton">
          <a class="btn btn-add pull-right" {{action 'showModal' 'add-layer-modal'}}><span class="mdi-content-add mdi-large"></span> Layers</a>
        </script>
        
    </body>
</html>
